<div class="ui-g">

    <div class="ui-g-12">

        <h3>{{testFacility.name}} Test Facility Details</h3>

        <p-messages [value]="notificationMsgs" [closable]="false"></p-messages>

        <p-tabView (onChange)="handleChange($event)">

            <p-tabPanel header="Details" id='details'>

                <p-growl [value]="msgs"></p-growl>

                <div class="subsection">

                    <form #tfForm="ngForm" (ngSubmit)="onSubmit(tfForm.value)">

                        <!-- Begin Panel - Test Facility Name and Location -->

                        <p-panel header="Test Facility Name and Location">

                            <div class="body">

                                <!-- Begin Name -->

                                <div class="input-row">

                                    <div class="md-inputfield">
                                        <input type="text" id="name" pInputText name="name" [(ngModel)]="testFacility.name" #testFacilityNameRef="ngModel"
                                            minlength="3" class="form-control" required row="20"
                                            (focus)="testFacilityNameRef.focus=true" (blur)="testFacilityNameRef.focus=false">
                                        <label>Name <span [ngClass]="{'error': testFacilityNameRef.errors?.required}">*</span></label>
                                    </div>

                                    <p class="helper error" *ngIf="testFacilityNameRef.errors?.required || testFacilityNameRef.errors?.minlength">At least three characters</p>

                                </div>

                                <!-- End Name -->

                                <!-- Begin Address Line 1 -->

                                <div class="input-row">

                                    <div class="md-inputfield">
                                        <input type="text" pInputText name="addressLine1" class="form-control" required row="20" [(ngModel)]="address.addressLine1"
                                            #tfAddress1Ref="ngModel"
                                            (focus)="tfAddress1Ref.focus=true" (blur)="tfAddress1Ref.focus=false">
                                        <label>Address Line 1 <span [ngClass]="{'error': tfAddress1Ref.errors?.required}">*</span></label>
                                    </div>

                                    <p class="helper hint" *ngIf="tfAddress1Ref.focus">For example, 123 Main Street</p>
                                    <p class="helper error" *ngIf="tfAddress1Ref.errors?.required && !tfAddress1Ref.focus">Required</p>

                                </div>

                                <!-- End Address Line 1 -->

                                <!-- Begin Address Line 2 -->

                                <div class="input-row">

                                    <div class="md-inputfield">
                                        <input type="text" pInputText class="form-control" row="20" name="addressLine2" [(ngModel)]="address.addressLine2"
                                            #tfAddress2Ref="ngModel"
                                            (focus)="tfAddress2Ref.focus=true" (blur)="tfAddress2Ref.focus=false">
                                        <label>Address Line 2</label>
                                    </div>

                                    <p class="helper hint" *ngIf="tfAddress2Ref.focus">For example, Suite 100 or Building 1</p>

                                </div>

                                <!-- End Address Line 2 -->

                                <!-- Begin City -->

                                <div class="input-row">

                                    <div class="md-inputfield">
                                        <input type="text" pInputText class="form-control" required row="20" name="city" #tfCityRef="ngModel" [(ngModel)]="address.city"
                                            (focus)="tfCityRef.focus=true" (blur)="tfCityRef.focus=false">
                                        <label>City <span [ngClass]="{'error': tfCityRef.errors?.required}">*</span></label>
                                    </div>

                                    <p class="helper error" *ngIf="tfCityRef.errors?.required && !tfCityRef.focus">Required</p>

                                </div>

                                <!-- End City -->

                                <!-- Begin State -->

                                <div class="input-row">

                                    <div class="md-inputfield">
                                        <input type="text" pInputText class="form-control" required row="20" name="state" [(ngModel)]="address.state" #tfstateRef="ngModel"
                                            (focus)="tfstateRef.focus=true" (blur)="tfstateRef.focus=false">
                                        <label>State <span [ngClass]="{'error': tfstateRef.errors?.required}">*</span></label>
                                    </div>

                                    <p class="helper error" *ngIf="tfstateRef.errors?.required && !tfstateRef.focus">Required</p>

                                </div>

                                <!-- End State -->

                                <!-- Begin Postal Code -->

                                <div class="input-row">

                                    <div class="md-inputfield">
                                        <input type="text" pInputText class="form-control" required row="20" name="postalCode" [(ngModel)]="address.postalCode" #tfpostalCodeRef="ngModel"
                                            (focus)="tfpostalCodeRef.focus=true" (blur)="tfpostalCodeRef.focus=false">
                                        <label>Postal Code <span [ngClass]="{'error': tfpostalCodeRef.errors?.required}">*</span></label>
                                    </div>

                                    <p class="helper error" *ngIf="tfpostalCodeRef.errors?.required && !tfpostalCodeRef.focus">Required</p>

                                </div>

                                <!-- End Postal Code -->

                            </div>

                            <footer>
                                <p>* indicates required field</p>
                                <button pButton type="submit" [disabled]="!tfForm.valid" label="Save" icon="ui-icon-save"></button>
                            </footer>

                        </p-panel>

                        <!-- End Panel - Test Facility Name and Location -->

                    </form>

                </div>

                <div class="subsection">

                    <form>

                        <!-- Begin Dialog - Assign User Role -->

                        <p-dialog header="Assign User Roles" [(visible)]="displayAssignUserRolesDialog" modal="modal" showEffect="fade" responsive="true">

                            <p>Please select one or more users and their role at the {{testFacility.name}} test facility.</p>

                            <!-- Begin Users -->

                            <div class="input-row">

                                <label><span class="text">Users</span>

                                    <p-autoComplete [(ngModel)]="filteredSelectedUserNames" [suggestions]="filteredUserNames" (completeMethod)="filterUserNames($event)"
                                                    name="username" styleClass="wid100" [minLength]="1" placeholder="Search by Name/#"
                                                    field="firstName" [multiple]="true">
                                    </p-autoComplete>

                                </label>

                            </div>

                            <!-- End Users -->

                            <!-- Begin Role -->

                            <div class="input-row">

                                <!-- Note: p-dropdown includes a "label" element, so it should not be wrapped in another one. -->
                                <span class="pseudo-label">Role</span>

                                <p-dropdown [options]="userRoles" (onChange)="onUserRoleChange($event)" name="userRole" [style]="{'width':'auto'}"></p-dropdown>

                            </div>

                            <!-- End Role -->

                            <footer>
                                <div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix">
                                    <button type="button" pButton icon="ui-icon-close" (click)="displayAssignUserRolesDialog=false" label="Cancel"></button>
                                    <button type="button" pButton icon="ui-icon-save" (click)="onAddUserRole()" label="Assign User Role"></button>
                                </div>
                            </footer>

                        </p-dialog>

                        <!-- End Dialog - Assign User Role -->

                        <!-- Begin Panel - Test Facility Users -->

                        <p-panel>

                            <header class="with-controls">
                                <p class="ui-panel-title">Test Facility Users</p>
                                <p class="controls"><button type="text" (click)="displayAssignUserRolesDialog=true" pButton icon="ui-icon-person-add" label="Assign User Roles&hellip;"></button></p>
                            </header>

                            <div class="ui-grid-row">

                                <p-dataTable [value]="TestFacilityRoles">
                                    <p-column field="name" header="Name" sortable="true"></p-column>
                                    <p-column field="role" header="Role" sortable="true"></p-column>
                                </p-dataTable>

                            </div>

                        </p-panel>

                        <!-- End Panel - Test Facility Users -->

                    </form>

                </div>

            </p-tabPanel>

            <p-tabPanel header="Equipment" id="equipment" headerStyleClass="equipment">
                <p-growl [value]="msgs"></p-growl>
                <p-panel>
                    <div class="ui-grid-col-4"></div>
                    <div class="ui-grid-row">
                        <div class="ui-grid-col-2">
                            <b>Test Facility Equipments</b>
                        </div>
                        <div class="ui-grid-col-2"></div>
                        <p-dataTable [value]="TestFacilityEquipments" selectionMode="single" 
                                                        [paginator]="true" rows="15" [responsive]="true">
                            <p-column field="equipmentName" header="Equipment Name" sortable="true"></p-column>
                            <p-column field="serialNumber" header="Serial Number" sortable="true"></p-column>
                            <p-column field="equipmentTypeName" header="Equipment TypeName" sortable="true"></p-column>
                            <p-column>
                                <template pTemplate type="header">
                                    <button type="button" pButton icon="fa-refresh"></button>
                                </template>
                                <template let-TestFacilityEquipment="rowData" pTemplate type="body">
                                    <button pButton type="button" (click)="showEquipmentDialog(TestFacilityEquipment)">Move To Another TestFacility</button>
                                </template>
                            </p-column>
                        </p-dataTable>
                        <p-dialog header="Test Facility Equipments" [(visible)]="displayEquipmentDialog" [responsive]="true" showEffect="fade" [modal]="true" width="300">
                              <div class="ui-grid-row">
                                <div class="ui-grid-col-4"><label for="name">Choose Test Facility</label></div>
                                <div class="ui-grid-col-8">
                                    <p-dropdown [options]="testFacilities" (onChange)="onTestFacilityChange($event)" name="testFacilities" [style]="{'width':'auto'}">
                                    </p-dropdown>
                                </div>
                            </div>
                            <footer>
                                <div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix">
                                    <button type="button" pButton icon="fa-close" routerLink="/testfacilities" label="Cancel"></button>
                                    <button type="button" pButton icon="fa-check" (click)="moveEquipmenttoTestFacility()" label="Ok"></button>
                                </div>
                            </footer>
                        </p-dialog>
                    </div>
                </p-panel>

            </p-tabPanel>


            <p-tabPanel header="Schedule" id="schedule" headerStyleClass="schedule">
                <div class="card card-w-title">

                    <div class="row">
                        <div class="ui-grid-col-1">
                            Project Code :
                        </div>
                        <div class="ui-grid-col-2">
                            <p-multiSelect [options]="projectCodes" (onChange)="onProjectCodeChange($event)" name="projectCodes" [style]="{'width':'auto'}">
                            </p-multiSelect>
                        </div>
                        <div class="ui-grid-col-1">
                            Test Facility :
                        </div>
                        <div class="ui-grid-col-2">
                            <p-multiSelect [options]="testFacilities" (onChange)="onTestFacilityChange($event)" name="testFacilities" [style]="{'width':'auto'}">
                            </p-multiSelect>
                        </div>
                        <div class="ui-grid-col-1">
                            Test Mode :
                        </div>
                        <div class="ui-grid-col-2">
                            <p-multiSelect [options]="testAllModes" (onChange)="onTestModeChange($event)" name="testModes" [style]="{'width':'auto'}">
                            </p-multiSelect>
                        </div>
                        <div class="ui-grid-col-1">
                            Test Type :
                        </div>
                        <div class="ui-grid-col-2">
                            <p-multiSelect [options]="testTypes" (onChange)="onTestTypeChange($event)" name="testTypes" [style]="{'width':'auto'}">
                            </p-multiSelect>
                        </div>
                        <div class="ui-grid-col-1">
                             Test Status :
                        </div>
                        <div class="ui-grid-col-2">
                            <p-multiSelect [options]="testStatus" (onChange)="onTestStatusChange($event)" name="testStatus" [style]="{'width':'auto'}">
                            </p-multiSelect>
                        </div>
                        <div class="ui-grid-col-1">
                             Test Roles:
                        </div>
                        <div class="ui-grid-col-2">
                            <p-multiSelect [options]="testRoles" (onChange)="onTestRoleChange($event)" name="testRoles" [style]="{'width':'auto'}">
                            </p-multiSelect>
                        </div>
                        <div class="ui-grid-col-1">
                             Build Levels :
                        </div>
                        <div class="ui-grid-col-2">
                            <p-multiSelect [options]="buildLevels" (onChange)="onBuildLevelChange($event)" name="buildLevels" [style]="{'width':'auto'}">
                            </p-multiSelect>
                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="col-sm-12">

                        <div class="row" id="scheduleCalendarContainer">
                            <div id="calendar">
                            </div>

                        </div>

                    </div>
                </div>

            </p-tabPanel>


            <p-tabPanel header="Tests" id="tests">
                After a break of more than 15 years, director Francis Ford Coppola and writer Mario Puzo returned to the well for this third
                and final story of the fictional Corleone crime family. Two decades have passed, and crime kingpin Michael
                Corleone, now divorced from his wife Kay has nearly succeeded in keeping his promise that his family would
                one day be completely legitimate.
            </p-tabPanel>

            <p-tabPanel header="Attachments" id="attachments">
                <h2>Attachments</h2>
                <p-growl [value]="msgs"></p-growl>

                <p-fileUpload [name]="testfacility" url="http://titanapi-preprod.12thwonder.com/api/file/SaveDocuments/{{entityType}}/{{entityId}}" (onUpload)="onUpload($event)"
                              multiple="multiple" accept="image/*" maxFileSize="1000000">
                    <template pTemplate type="content">
                        <ul *ngIf="uploadedFiles.length">
                            <li *ngFor="let file of uploadedFiles">{{file.name}} - {{file.size}} bytes</li>
                        </ul>
                        <div class="ui-grid-row">
                            <div class="ui-grid-col-2"><b>Test Facility Attachments</b></div>
                            <div class="ui-grid-col-2"></div>

                            <p-dataTable [value]="TestFacilityAttachments">
                                <p-column field="name" header="Name"></p-column>
                                <p-column>
                                    <template pTemplate type="header">
                                        <button type="button" pButton icon="fa-refresh"></button>
                                    </template>
                                    <template let-TestFacilityAttachment="rowData" pTemplate type="body">
                                        <a href="{{titanApiUrl}}TestFacilityAttachment/file/{{TestFacilityAttachment.id}}">download</a>
                                    </template>
                                </p-column>
                                <p-column>
                                    <template pTemplate type="header">
                                        <button type="button" pButton icon="fa-refresh"></button>
                                    </template>
                                    <template let-TestFacilityAttachment="rowData" pTemplate type="body">
                                        <button pButton type="button">delete</button>
                                    </template>
                                </p-column>
                            </p-dataTable>
                        </div>
                    </template>
                </p-fileUpload>
            </p-tabPanel>


        </p-tabView>
    </div>

</div>